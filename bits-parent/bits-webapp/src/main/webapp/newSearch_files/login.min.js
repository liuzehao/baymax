var callBackFunction="";var callParams=[];function checkUserLogin(callback,params){var logined=true;$.ajax({url:"/ajax/userlogincheck.ashx?"+Math.random(),dataType:"json",async:false,success:function(json){logined=json.isLogined},error:function(){logined=false}});if(!logined&&$("#divLoginBox").is(":hidden")){$(".layer-bg").show();$("#divLoginBox").find("#txtLPassword").val("");$("#divLoginBox").setWindowCenter().show();callBackFunction=(callback||loginAfter);callParams=(params||[])}else{if(callback){var p="";if(params){for(var i=0;i<params.length;i++){var temp=params[i];if(isNaN(params[i])){temp="'"+params[i]+"'"}if(p==""){p=temp}else{p+=","+temp}}}eval("callback("+p+")")}}return logined}function normalLogin(){var username=$("#txtLUsername").val().trim();var passwpord=$("#txtLPassword").val().trim();if(username==""){$("#divLoginError").html("请输入用户名！");return false}if(getLength(username)>100){$("#divLoginError").html("请输入小于 100 个字符的用户名！");return false}if(passwpord==""){$("#divLoginError").html("请输入密码！");return false}$.getJSON("/user/login.aspx?"+Math.random(),{operate:"NormalLogin",username:username,password:passwpord},function(json){if(json.error){$("#divLoginError").html(json.error);return false}$("#divLoginError").html("");$("#divLoginBox").hide();$("#liTraceData").hide();$("#liIndexData").hide();$("#liByData").hide();$("#liTraceData2").hide();$("#liIndexData2").hide();$("#liByData2").hide();$(".layer-bg").hide();if(json.TraceRight){$("#liTraceData").show().find("a").attr("href",json.TraceUrl)}else{$("#liTraceData2").show()}if(json.IndexRight){$("#liIndexData").show().find("a").attr("href",json.IndexUrl)}else{$("#liIndexData2").show()}if(json.ByRight){$("#liByData").show().find("a").attr("href",json.ByUrl)}else{$("#liByData2").show()}userpermissions();if(callBackFunction){var p="";if(callParams){for(var i=0;i<callParams.length;i++){var temp=callParams[i];if(isNaN(callParams[i])){temp="'"+callParams[i]+"'"}if(p==""){p=temp}else{p+=","+temp}}}if(callBackFunction==loginAfter){loginAfter()}else{loginAfter();eval("callBackFunction("+p+")")}}return true})}function ipLogin(){$.getJSON("/user/login.aspx?"+Math.random(),{operate:"IPLogin"},function(json){if(json.error){$("#divLoginError").html(json.error);return false}$("#divLoginError").html("");$("#divLoginBox").hide();$("#liTraceData").hide();$("#liIndexData").hide();$("#liByData").hide();$("#liTraceData2").hide();$("#liIndexData2").hide();$("#liByData2").hide();$(".layer-bg").hide();if(json.TraceRight){$("#liTraceData").show().find("a").attr("href",json.TraceUrl)}else{$("#liTraceData2").show()}if(json.IndexRight){$("#liIndexData").show().find("a").attr("href",json.IndexUrl)}else{$("#liIndexData2").show()}if(json.ByRight){$("#liByData").show().find("a").attr("href",json.ByUrl)}else{$("#liByData2").show()}userpermissions();if(callBackFunction){var p="";if(callParams){for(var i=0;i<callParams.length;i++){var temp=callParams[i];if(isNaN(callParams[i])){temp="'"+callParams[i]+"'"}if(p==""){p=temp}else{p+=","+temp}}}if(callBackFunction==loginAfter){loginAfter()}else{loginAfter();eval("callBackFunction("+p+")")}}return true})}function loginAfter(){$("#loginLoading").html("正在加载，请稍候...").load("/user/loginheader.aspx?"+Math.random())}function userpermissions(){if($("#hifOutObjectType").length==1&&$("#hifOutObjectType").val()=="Articles"){var b="<img src='/images/zoomloader.gif' alt='正在加载，请稍候...' />";$(".permissinshow").html(b);var a="",c=GetQueryString("ls");$(".search-result input:checkbox").each(function(){a+=$(this).val()+","});if(a){$.getJSON("/ajax/articlepermissions.ashx",{ids:a,ls:c,_t:+new Date},function(d){$.each(d,function(e,f){$(".search-result-list").find("input:checkbox[value='"+f.id+"']").parent().parent().find(".permissinshow").html(f.img);$(".search-result-list").find("input:checkbox[value='"+f.id+"']").parent().parent().find(".permissinimg").html(f.page);$("img[name='paperpreview']").lazyload();var g=$(window).width();$(".jqzoom").jqzoom({zoomType:"standard",alwaysOn:false,zoomWidth:g>1300?800:580,zoomHeight:300,preloadImages:false,position:"left"});$(".jqzoom").hover(function(){$(this).parents("dl").css("z-index","11").siblings().css("z-index","0")},function(){$(".search-result-list").find("dl").removeAttr("style")})})})}}}$(document).ready(function(){$("#divLoginBox").find(":input").keydown(function(b){var a=$.event.fix(b);if(a.keyCode==13){return normalLogin()}});$("#btnLoginClose").click(function(){$("#divLoginError").html("");$("#divLoginBox").find("#txtLPassword").val("");$("#divLoginBox").hide();$(".layer-bg").hide()})});