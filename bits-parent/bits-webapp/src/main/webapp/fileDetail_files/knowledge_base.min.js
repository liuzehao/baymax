!function(golbal,unf){var g,$,doc,csdn,exports={},knowledge_web;g=golbal?golbal:"window",doc=g.document||unf,$=g.jQuery?g.jQuery:unf,csdn=g.csdn||exports,$(function(){!function(t){t(g,$,unf),csdn.knowledge_web=csdn.knowledge_web||{};for(var e in knowledge_web)exports[e]=csdn.knowledge_web[e]=knowledge_web[e];exports.init()}(function(g,$,unf){knowledge_web={init:function(fn){var This=this;if(This.recordingArr=[],This.recordingDataArr=[],This.recordIds=[],This.urls={treeurl:"/expert/init_base_tree",doYes:"/expert/yes",doNo:"/expert/no",doCancle:"/expert/cancle",menurl:"/sub/:id/detail",attentionurl:"../../test/test.php"},$(".tagcgl").length>0&&(this.listhover($(".tablists > ul")),this.layer(function(obj){var funblock=This.funblock();_id=obj.tagobj.attr("data-id"),_types=obj.tagobj.attr("data-type")||0,This.recordIds.push(_id),_windowLayer=obj.windowLayerid,funblock._ajax({_url:This.urls.treeurl,_id:_id,_types:_types},function(reponse){var re=reponse,status=re.status,title=re.title,html=re.html,selectedhtml=re.selectedhtml;status&&($("#"+_windowLayer+" .title em").html(""),$("#"+_windowLayer+" .scrollMenu").html(""),$("#"+_windowLayer+" .selectlist ul").html(""),$("#"+_windowLayer+" .title em").html(title),$("#"+_windowLayer+" .scrollMenu").append($(html)),$("#"+_windowLayer+" .selectlist ul").html($(selectedhtml)),$("#"+_windowLayer+" .listselect").html(""),$("#"+_windowLayer+" .coltitle").addClass("hide")),funblock._scrollBar(),funblock._treeMenu(),funblock._rubdate(function(reponse){var re="object"===(typeof reponse).toLowerCase()?reponse:eval("("+reponse+")"),status=re.status,tabid=re.tabid||"";status&&($(".listselect li a[data-id="+tabid+"]").length>0&&($(".listselect li a[data-id="+tabid+"]").removeClass("root"),$(".listselect li a[data-id="+tabid+"]")[0].tag=!1),funblock._scrollBar())})}),funblock._scrollBar(),funblock._submitform()}),this.ajaxDelete()),$(".treerlist").length>0){var mid=$("#maintitle").length>0?$("#maintitle").attr("data-mid"):"";$.ajax({type:"get",url:"/node/"+mid+"/tree",async:!0,success:function(t){var e=t;e.status&&$(".treerlist ").length>0?($(".treerlist").html(e.html),This.funblock()._treeMenu()):""},error:function(t){alert("请求服务器失败！")}})}$(".top_search").length>0&&this.downlist(),$(".menuslist").length>0&&this.menuslist({isajax:!0}),this.kn_other()},
    listhover:function(t){var e=$(t).children();e.on("mouseenter",function(){$(this).find(".lefts").addClass("addWidth").end().find(".rights").addClass("show")}),e.on("mouseleave",function(){$(this).find(".lefts").removeClass("addWidth").end().find(".rights").removeClass("show")})},funblock:function(){var t=this;return{_scrollBar:function(){function t(t){function e(){function t(){$(doc).on("mousemove",function(t){var e=s.y,a=t.clientY-e;return 0>=a&&(a=0),a>s.max&&(a=s.max),s.pro=a/s.max,s.css({top:a}),n.css({top:-s.pro*n.max}),t.stopPropagation(),!1}),$(doc).on("selectstart",function(){return!1})}function e(){$(doc).off("mousemove")}s.on("mousedown",function(e){return s.y=e.clientY-parseFloat($(this).position().top,10),t(),e.stopPropagation(),!1}),$(doc).on("mouseup",function(t){return e(),t.stopPropagation(),!1})}var n,a,i,r,s;return n=t.find(".scrollDoc")||unf,a=parseFloat(t.outerHeight(),10),i=parseFloat(n.outerHeight(),10),r=t.find(".scrollblank")||unf,s=t.find(".scrollbars")||unf,s.pro=0,n.max=i-a,s.max=parseFloat(r.outerHeight(),10)-parseFloat(s.height(),10),i>a?(s.removeClass("hide"),void e()):(s.addClass("hide"),!1)}var e;e=$(".addScroll")||unf,e.each(function(e,n){t($(n))})},_treeMenu:function(e){function n(e){return _id=$(this).attr("data-mid"),_type=$(this).attr("data-type"),_this=$(this),"treeexpert"===o?a({_id:_id,_type:_type,_url:i},function(e){var n=e,a=n.status,i=n.html,r=n.treelayer;if(a&&"treeexpert"===o){if(r===!1)return $(".listselect").prev(".coltitle").removeClass("hide"),$(".listselect").show(),$(".listselect").html(""),$(".listselect").html($(i)),t.recordingArr=[],$(_this).parents("li").each(function(e,n){t.recordingArr.unshift($(n).children("a").find("em").html())}),l._sonclick(),l._scrollBar(),!1;if(_this.next().remove(),_this.parent().append($(i)),t.recordingDataArr.length>0){for(var s=_this.parent().parents("li").length<=0?_this.attr("data-mid"):_this.parent().parents("li").children("a").attr("data-mid"),c=0;c<t.recordingDataArr.length;c++)for(var d in t.recordingDataArr[c])if(d==="datag"+s){var h=t.recordingDataArr[c]["datag"+s];break}h&&_this.siblings("ul").children("li").find("a em").each(function(t,e){for(var n=0;n<h.length;n++)if($.trim($(e).html())===$.trim(h[n])){$(e).parent().addClass("curoot");break}})}if($(_this).next().length<=0)return!1;if($(_this).hasClass("noclick"))return!1;$(_this)[0].flg==unf||0==$(_this)[0].flg?($(_this).addClass("lessj"),$(_this).parent().children("ul").show(),$(_this)[0].flg=!0):($(_this).removeClass("lessj"),$(_this).parent().children("ul").hide(),$(_this)[0].flg=!1),l._scrollBar()}}):"treehome"===o?"em"==e.target.tagName.toLocaleLowerCase()?(i="/node/"+_id+"/detail",t.titleArr=[],a({_id:_id,_type:_type,_url:i},function(t){var e=t,n=e.status,a=e.html;n&&"treehome"===o&&($(_this).parent().parents("ul").length>2?function(){$(".treerlist li a").removeClass("root"),$(_this).parents("li").children("a").addClass("root")}():($(".treerlist li a").removeClass("root"),$(_this).addClass("root")),a?$(".rightcontent").html(a):"")})):$(_this)[0].flg==unf||0==$(_this)[0].flg?($(_this).parent().siblings().find("ul").hide(),$(_this).parent().siblings().find("a i").html("+"),$(_this).parent().siblings().find("a").each(function(t,e){e.flg=!1}),$(_this).parent().children("ul").show(),$(_this)[0].flg=!0,$(_this).find("i").length>0?$(_this).find("i").html("-"):""):($(_this).parent().children("ul").hide(),$(_this)[0].flg=!1,$(_this).find("i").length>0?$(_this).find("i").html("+"):""):"",e.stopPropagation(),e.preventDefault(),!1}function a(t,e){var n=t._id,a=t._url,i=t._type;$.ajax({url:a,type:"get",async:!0,data:{mid:n,node_type:i},success:function(t){e?e(t):""},error:function(){alert("树形菜单请求失败!")}})}var i,r,s,l=this,o="";if($(".tagcgl").length>0){var r,c,d;$(".selectlist li span").each(function(e,n){var a=$(n).attr("data-mid");d=$(n),$(".treeMenu > li > a").each(function(e,n){var i=$(n).attr("data-mid");if(i==a){var s,l=$(d).text().split("-"),o="datag",h={};return r=l.length>2?l.length-1:-1,s=l.slice(1,r),c=$(n),o+=a,h[o]=s,void t.recordingDataArr.push(h)}}),(null!=c||c)&&$(c).addClass("curoot")})}$(".treeMenu li a").each(function(t,e){"ul"!==$(this).parent().parent()[0].tagName.toLowerCase()||$(e).hasClass("noclick")||(e.flg=!1)}),o=$(".treeMenu").hasClass("treerlist")?"treehome":(i=t.urls.treeurl,"treeexpert"),$(doc).on("click",".treeMenu li a",n),"treehome"===o?(s=$(".treeMenu li .root"),r=s.length,s.eq(r-1).parents("ul").show(),s.each(function(t,e){e.flg=!0}),s.each(function(t,e){t<s.length-1?$(e).find("i").html("-"):""})):""},_sonclick:function(){function t(t){var e,n,e=$(this),n=$(this).parent().children(".subc").html(),a=$(this).attr("data-id");return e[0].tag?!1:(e.addClass("root"),i._opdate({text:n,id:a},function(){e.attr("data-id");e[0].tag=!0,i._scrollBar()}),t.stopPropagation(),t.preventDefault(),!1)}var e,n=$(".listselect")||unf,a=$(".selectlist ul > li"),i=this;return n.length<=0?!1:(e=n.children().find("a"),e.each(function(t,e){var n=$(e).attr("data-id");a.each(function(t,a){var i=$(a).attr("data-tabid");i==n&&($(e).addClass("root"),e.tag=!0)})}),void e.on("click",t))},_opdate:function(e,n){for(var a=$(".selectlist ul"),i=a.children(),r="",s=e.text||"",l=e.id||0,o=0;o<t.recordingArr.length;o++)r+=t.recordingArr[o]+" - ";var c=$("<li class='clearfix' data-tabid="+l+"><span>"+r+"<em>"+s+"</em></span><a href='' class='rubbish'></a></li>");i.length>0?c.insertBefore(i.eq(0)):a.append(c),n?n():""},_rubdate:function(t){$(doc).on("click",".selectlist li .rubbish",function(e){var n,a=(Number($(this).parent().attr("data-id"),10),$(this));return n=a.parent().attr("data-tabid"),$(this).parent().empty().remove(),t?t({status:!0,tabid:n}):"",e.stopPropagation(),e.preventDefault(),!1})},_ajax:function(t,e){_id=t._id,_url=t._url,_types=t._types,_appendDom=t._appendDom,$.ajax({type:"get",async:!0,url:_url,data:{dataid:_id,_types:_types},success:function(t){e(t)},error:function(){alert("服务器请求失败")}})},_submitform:function(){var e=t.recordIds.shift(),n=$("#subhide");return n.length<=0?(alert("缺少提交域!"),!1):void $("#subClick").on("click",function(a){return t.recordIds=[],$(".selectlist ul li").each(function(n,a){var i=$(a).attr("data-tabid");t.recordIds[n]="["+e+","+i+"]"}),n.val(""),n.val(t.recordIds.join(",")),n.val()?$(this).parents("form").submit():alert("已选知识点不能为空!"),a.stopPropagation(),a.preventDefault(),!1})},_hover:function(t,e){var n,a=t._optag||"",i=t._tag||"",r=t._targetag||"",s=t._hoveAddropt||[],l="",o="",c=function(t,e){return"string"===(typeof t).toLowerCase()?t=$(t):t,2!=s.length?n=new Error("添加hover参数有误！"):(l=s[0],o=s[1],void t.hover(function(){l.length>0?$(this).find(l).addClass(o):0,$(this).find(e).show()},function(){l.length>0?$(this).find(l).removeClass(o):0,$(this).find(e).hide()}))};n=a.length>0&&i.length>0&&r.length>0?$(a+i).length>0?c($(a+i),r):new Error("操作的目标父亲标注!"):new Error("缺少操作对象，请添加"),e?e(n):""},_scrollMove:function(t,e){function n(){c=setInterval(function(){o>=g-1&&(o=-1),o++,s?($(i).eq(o).siblings().removeClass(s),$(i).eq(o).addClass(s)):"",$(r).stop().animate({left:-1*o*f},"slow")},d)}var a,i=t._btnstag||"",r=t._scrolltag||"",s=t._rootag||"",l=t.__isauto||!1,o=0,c=l?null:"",d=3e3;if(i.length<=0&&r.lengtg<=0)a=new Error("请添加滚动指定的标签！");else{var h,u,f=$(r).children().eq(0).innerWidth(),g=$(r).children().size(),p=0;$(r).width(f*g),i instanceof Array&&"length"in i&&2==i.length?(_leftbtn=$(i[0]).length>0?h=$(i[0]):"",_rightbtn=$(i[1]).length>0?u=$(i[1]):"",h&&u?(_rightbtn.on("click",function(t){return p>=g-4?!1:(p++,$(r).stop().animate({left:-1*p*f},"fast"),t.stopPropagation(),t.preventDefault(),!1)}),_leftbtn.on("click",function(){return 0>=p?!1:(p--,$(r).stop().animate({left:-1*p*f},"fast"),event.stopPropagation(),event.preventDefault(),!1)})):g>4&&(a=new Error("参数有误找不到传入标注!"))):"string"===(typeof i).toLowerCase()?($(i).on("click",function(t){var e=$(this).index();return clearInterval(c),o=e,s?($(this).siblings().removeClass(s),$(this).addClass(s)):"",$(r).stop().animate({left:-1*e*f},"slow"),n(),t.stopPropagation(),t.preventDefault(),!1}),$(i).eq(0).trigger("click"),l?n():""):a=new Error("参数有误传入格式为数组或者字符串!"),e?e(a):""}}}},tabclicked:function(t){var e,n,a,i,r;return r=this,e=$(".tabclick")||unf,n=e?e.children():unf,a=$(".tablists")||unf,i=a?a.children():unf,n.eq(0).addClass("root"),i.eq(0).addClass("show"),n.on("click",function(e){var n=$(this).index();return $(this).addClass("root").siblings().removeClass("root"),$(i).eq(n).addClass("show").siblings().removeClass("show"),t?t($(i).eq(n)):"",e.stopPropagation(),e.preventDefault(),!1}),t?t($(i).eq(0)):""},layer:function(t){$(doc).off("click",".tagclick"),$(doc).on("click",".tagclick",function(e){var n,a,i,r,s="windowLayer",l=$(this).attr("data-layer-id")||"",o=$(this).attr("data-type")||0;return n=$("."+s)||"",a=$(".marklayer")||"",n.length<=0||a.length<=0?(alert("请添加弹框的DOM格式"),!1):a.length>1||n.length>1?(alert("弹框和遮罩请唯一"),!1):(i=l?l:"",n.attr({id:s+l,"data-id":i,"data-type":o}),$("#"+s+l).show(),a.css({height:parseFloat($(doc).height(),10)>parseFloat($(g).height(),10)?parseFloat($(doc).height(),10):parseFloat($(g).height(),10)}).show(),$(".closec").off("click"),$(".closec").on("click",function(t){return $("#"+s+l).hide(),($(".tagcgl").length>0||$(".treerlist").length>0)&&$(doc).off("click",".treeMenu li a"),a.hide(),t.stopPropagation(),t.preventDefault(),!1}),r={tagobj:$(this),windowLayerid:s+l},t?t(r):"",e.stopPropagation(),e.preventDefault(),!1)})},ajaxDelete:function(){function t(t,e){var n;if(a=e.id,obj=e.obj,!a||!obj)return!1;var i=parseInt($("#approving").html().replace(/[^0-9]/gi,"")),r=parseInt($("#approved").html().replace(/[^0-9]/gi,""));$.ajax({url:t,type:"get",async:!0,data:{id:a},success:function(t){var e,a,s;e=Number(t.succ,10)||"",a=t.msg||"",s=t.add,0==e&&a&&alert(a),1==e&&a&&(obj.parents("li").empty().remove(),i-=1,$("#approving").html("待审核内容("+i+")"),0==s?$("#approved").html("已收录内容("+r+")"):1==s&&(r+=1,$("#approved").html("已收录内容("+r+")")),n=$(".tablists").children("ul").children("li").length,0>=n?window.location.reload():"")},error:function(t){alert(t)}})}var e,n,a,i=this;$(".opclick").on("click",function(r){e=$(this).attr("class").split(" "),a=$(this).attr("data-id");for(var s in i.urls)if(e[0]===s){n=i.urls[s];break}return t(n,{id:a,obj:$(this)}),r.stopPropagation(),r.preventDefault(),!1})},downlist:function(){var t=null;$(".dowlistbtn").on("click",function(e){return t=$(this),$(".dowlistbtn").length>0&&$(this).next(".downlists").length>0?$(this)[0].flg?($(this).next(".downlists").addClass("hide"),$(this)[0].flg=!1):($(this).next(".downlists").removeClass("hide"),$(this)[0].flg=!0):alert("缺少对应标签！"),e.stopPropagation(),e.preventDefault(),!1}),$(".downlists li a").on("click",function(t){var e=$(this).html(),n=$(this).attr("data-id");return $(".dowlistbtn b").html(e),$(".downlists").addClass("hide"),$(".dowlistbtn")[0].flg=!1,$("#serchhide").val(n),t.stopPropagation(),t.preventDefault(),!1}),$(document).on("click",function(e){t&&(t.next(".downlists").addClass("hide"),t[0].flg=!1,t=null),e.stopPropagation()})},menuslist:function(t){var e,n,a,i=!1,r=this;i=t.isajax||i,$(".menuslist").length>0&&$(".rightset").length>0&&$(".rightset .listcontents").length>0&&(e=$(".menuslist").children().find("a")?$(".menuslist").children().find("a"):$(".menuslist").children(),n=$(".rightset .listcontents"),e&&n&&($(e).eq(0).parent().addClass("root"),$(e).on("click",function(t){var e=$(this);return i&&r.urls.menurl&&(a=$(this).attr("data-id")||!1,a?r.funblock()._ajax({_id:"",_url:"/sub/"+a+"/detail"},function(t){var a=t,i=a.html;a.status?($(e).parent().siblings().removeClass("root"),$(e).parent().addClass("root"),n.html(""),n.html($(i)),r.funblock()._hover({_optag:".rightset .listcontents",_tag:">li",_targetag:".cancelgz",_hoveAddropt:[".leftc a","root"]},function(t){"object"===(typeof t).toLowerCase()?alert(t.message):$(".cancelgz").on("click",function(t){var e=$(this).attr("data-status"),n=[],a=$(this);return $(this).parents("li").find(".leftc a").each(function(t,e){n[t]=$(e).attr("data-pid")}),n.push(e),r.funblock()._ajax({_id:n,_url:r.urls.attentionurl},function(t){var e=t,n=e.status,i=e.isatten;n?(i===!1?a.html("关注"):a.html("取消关注"),a.attr("data-status",i)):""}),t.stopPropagation(),t.preventDefault(),!1})})):alert("请求数据返回失败")}):""),t.stopPropagation(),t.preventDefault(),!1}),$(e).eq(0).trigger("click")))},kn_other:function(){$(".listbtn > li").length>0&&this.funblock()._scrollMove({_btnstag:".listbtn > li",_scrolltag:".divoverhide .list03",_rootag:"root",_isauto:!0},function(t){"object"===(typeof t).toLowerCase()?alert(t.message):""}),function(){var t,e=$(".btnclick");e.length>0&&(e.hasClass("ygzb")?e.hover(function(){"false"==e.attr("isatten")&&($(e).html("取消关注"),$(e).removeClass("ygzb"),$(e).addClass("cancelgz"))},function(){"false"==e.attr("isatten")&&($(e).html('<em class="fa fa-check"></em>已关注'),$(e).removeClass("cancelgz"),$(e).addClass("ygzb"))}):e.off("hover")),e.length>0?function(){e.on("click",t=function(e){var n=$(this).attr("isatten"),a=$(this).attr("data-id"),i=$(this),r="true"===n?"/mobile/node/subscription":"/mobile/node/remove_subscription";return $.ajax({type:"POST",async:!0,data:{id:a,type:1},dataType:"json",url:r,success:function(e){var a=e,r=a.status;1==r?n="true"===n?!1:!0:"",r?(n===!1?(i.html('<em class="fa fa-check"></em>已关注'),i.removeClass("gzb"),i.off("click"),i.addClass("ygzb"),i.attr("isatten",n),function(){i.hasClass("ygzb")?i.hover(function(){"false"==i.attr("isatten")?($(this).html("取消关注"),$(this).removeClass("ygzb"),$(this).addClass("cancelgz"),i.off("click"),i.on("click",t)):i.unbind("hover")},function(){"false"==i.attr("isatten")?($(this).html('<em class="fa fa-check"></em>已关注'),$(this).removeClass("cancelgz"),$(this).addClass("ygzb"),i.off("click")):i.unbind("hover")}):i.off("hover")}()):(i.off("hover"),i.off("click"),i.on("click",t),i.html("<em>+</em>关注"),i.removeClass("ygzb"),i.removeClass("cancelgz"),i.addClass("gzb")),i.attr("isatten",n)):alert(a.error||"服务错误")},error:function(t){alert(t)}}),e.stopPropagation(),e.preventDefault(),!1})}():""}(),function(){$("#closed").length>0&&$("#closed").on("click",function(t){return $(this).parent().hide(),t.stopPropagation(),t.preventDefault(),!1})}()}}})})}(window);